
{% load static %} <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión Paul Odonto</title>
    <link rel="icon" type="image/png" href="{% static 'images/logo.png' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        .sidebar { min-height: 100vh; background-color: #2c3e50; color: white; }
        .sidebar a { color: #ecf0f1; text-decoration: none; padding: 10px 15px; display: block; }
        .sidebar a:hover { background-color: #34495e; color: #3498db; }
        .sidebar .active { background-color: #3498db; color: white; }
    </style>
    <style>
    /* 1. Fondo general más agresivo */
    body.dark-mode, 
    body.dark-mode main,
    body.dark-mode .container-fluid {
        background-color: #454545 !important;
        color: #e0e0e0 !important;
    }

    /* 2. Forzar que las tarjetas y bloques blancos se vuelvan grises */
    body.dark-mode .card,
    body.dark-mode .bg-light,
    body.dark-mode .bg-white {
        background-color: #555555 !important; /* Gris un poco más claro para diferenciar */
        color: white !important;
        border-color: #666 !important;
    }

    /* 3. Arreglar las tablas (para que no queden letras negras sobre fondo oscuro) */
    body.dark-mode .table {
        color: white !important;
        border-color: #777;
    }
    body.dark-mode .table-striped > tbody > tr:nth-of-type(odd) > * {
        background-color: rgba(255, 255, 255, 0.05) !important; /* Rayado sutil */
        color: white !important;
    }
    body.dark-mode .table-hover > tbody > tr:hover > * {
        background-color: rgba(255, 255, 255, 0.1) !important;
        color: white !important;
    }

    /* 4. Arreglar los Formularios (Inputs y Selects) */
    body.dark-mode .form-control,
    body.dark-mode .form-select,
    body.dark-mode input,
    body.dark-mode textarea {
        background-color: #666 !important;
        color: white !important;
        border: 1px solid #888 !important;
    }
    
    /* Placeholder (el texto gris clarito adentro de los inputs) */
    body.dark-mode ::placeholder {
        color: #ccc !important;
        opacity: 1;
    }

    /* 5. Títulos y links */
    body.dark-mode h1, body.dark-mode h2, body.dark-mode h3, 
    body.dark-mode h4, body.dark-mode h5, body.dark-mode h6 {
        color: white !important;
    }
    body.dark-mode a {
        color: #6ea8fe !important; /* Azul clarito para que resalte en oscuro */
    }
    /* 1. Forzar fondo gris en TODAS las celdas, filas y cabeceras */
    body.dark-mode .table > :not(caption) > * > * {
        background-color: #555555 !important; 
        color: white !important;
        box-shadow: none !important; /* Saca bordes blancos raros */
    }

    /* 2. Efecto Hover (cuando pasás el mouse) un poquito más claro */
    body.dark-mode .table-hover > tbody > tr:hover > * {
        background-color: #666666 !important;
        color: white !important;
    }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-3 col-lg-2 sidebar p-0">
            
            <div class="w-100 bg-dark border-bottom">
                <img src="{% static 'images/logo.png' %}" alt="Logo" class="img-fluid d-block w-100" style="object-fit: cover;">
            </div>

            <div class="p-3 bg-dark bg-opacity-50 border-bottom border-secondary">
                {% if user.is_authenticated %}
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-person-circle fs-4 me-2"></i>
                        <div style="line-height: 1;">
                            <small class="text-white-50" style="font-size: 0.7rem;">HOLA,</small><br>
                            <span class="fw-bold">{{ user.username|upper }}</span>
                        </div>
                    </div>
                    
                    <form action="{% url 'logout' %}" method="post" class="d-grid">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-danger py-0">
                            <i class="bi bi-power"></i> Cerrar Sesión
                        </button>
                    </form>
                {% else %}
                    <div class="alert alert-warning p-1 text-center small mb-0">
                        <i class="bi bi-exclamation-circle"></i> No has iniciado sesión
                    </div>
                    <a href="{% url 'login' %}" class="btn btn-primary btn-sm w-100 mt-2">Ingresar</a>
                {% endif %}
            </div>
            <nav class="mt-2">
                <div class="text-muted small fw-bold px-3 mt-2 mb-1">MENU PRINCIPAL</div>
                        
                <a href="{% url 'lista_turnos' %}" class="{% if 'turnos' in request.path %}active{% endif %}">
                    <i class="bi bi-calendar-check me-2"></i> Agenda / Turnos
                </a>
                <a href="{% url 'lista_pacientes' %}" class="{% if 'pacientes' in request.path %}active{% endif %}">
                    <i class="bi bi-people me-2"></i> Pacientes
                </a>
                <a href="{% url 'balance' %}" class="{% if 'balance' in request.path %}active{% endif %}">
                    <i class="bi bi-cash-coin me-2"></i> Finanzas & Balance
                </a>

                <div class="text-muted small fw-bold px-3 mt-4 mb-1">CONFIGURACIÓN</div>
                        
                <a href="{% url 'lista_obras_sociales' %}" class="{% if 'obras-sociales' in request.path %}active{% endif %}">
                    <i class="bi bi-building me-2"></i> Obras Sociales
                </a>
                <a href="{% url 'lista_tratamientos' %}" class="{% if 'tratamientos' in request.path %}active{% endif %}">
                    <i class="bi bi-bandaid me-2"></i> Tratamientos
                </a>
                <a href="{% url 'lista_aranceles' %}" class="{% if 'aranceles' in request.path %}active{% endif %}">
                    <i class="bi bi-currency-dollar me-2"></i> Aranceles / Precios
                </a>
                <a href="{% url 'lista_categorias' %}" class="{% if 'categorias' in request.path %}active{% endif %}">
                    <i class="bi bi-tags me-2"></i> Categorías de Gastos
                </a>
                <button id="btnModoOscuro" class="btn btn-outline-light w-100 mt-3">
                    <i class="bi bi-moon-stars-fill"></i> Modo Oscuro
                </button>
            </nav>
        </div>

        <main class="col-md-9 col-lg-10 p-4 bg-light">
            {% block content %}
            {% endblock %}
        </main>
    </div>
</div>

<script>
    const boton = document.getElementById('btnModoOscuro');
    const cuerpo = document.body;

    // 1. Al cargar, preguntar si ya estaba activado antes
    if (localStorage.getItem('tema') === 'oscuro') {
        cuerpo.classList.add('dark-mode');
        boton.innerHTML = '<i class="bi bi-sun-fill"></i> Modo Claro';
        boton.classList.replace('btn-outline-light', 'btn-outline-warning');
    }

    // 2. Al hacer click, cambiar y guardar
    boton.addEventListener('click', () => {
        cuerpo.classList.toggle('dark-mode');

        if (cuerpo.classList.contains('dark-mode')) {
            localStorage.setItem('tema', 'oscuro');
            boton.innerHTML = '<i class="bi bi-sun-fill"></i> Modo Claro';
            boton.classList.replace('btn-outline-light', 'btn-outline-warning');
        } else {
            localStorage.setItem('tema', 'claro');
            boton.innerHTML = '<i class="bi bi-moon-stars-fill"></i> Modo Oscuro';
            boton.classList.replace('btn-outline-warning', 'btn-outline-light');
        }
    });
</script>
</body>
</html>